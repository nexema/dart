{"version":1,"hashcode":"9416416803567337367","files":[{"id":"15228718835168607873","packageName":"common","path":"v1/common/entity.nex","types":[{"id":"9851093560426766228","name":"Entity","documentation":null,"annotations":null,"modifier":"base","baseType":null,"fields":[{"name":"id","index":0,"type":{"arguments":null,"kind":"primitiveValueType","nullable":false,"primitive":"string"},"documentation":null,"annotations":null},{"name":"created_at","index":1,"type":{"arguments":null,"kind":"primitiveValueType","nullable":false,"primitive":"timestamp"},"documentation":null,"annotations":null},{"name":"deleted_at","index":2,"type":{"arguments":null,"kind":"primitiveValueType","nullable":true,"primitive":"timestamp"},"documentation":null,"annotations":null},{"name":"modified_at","index":3,"type":{"arguments":null,"kind":"primitiveValueType","nullable":true,"primitive":"timestamp"},"documentation":null,"annotations":null}],"defaults":null}]},{"id":"5758910570454447854","packageName":"location","path":"v1/common/location/address.nex","types":[{"id":"13009575510080279639","name":"Address","documentation":null,"annotations":null,"modifier":"struct","baseType":null,"fields":[{"name":"id","index":0,"type":{"arguments":null,"kind":"primitiveValueType","nullable":false,"primitive":"string"},"documentation":null,"annotations":null},{"name":"city","index":1,"type":{"arguments":null,"kind":"primitiveValueType","nullable":false,"primitive":"string"},"documentation":null,"annotations":null},{"name":"region","index":2,"type":{"arguments":null,"kind":"primitiveValueType","nullable":false,"primitive":"string"},"documentation":null,"annotations":null},{"name":"country","index":3,"type":{"arguments":null,"kind":"primitiveValueType","nullable":false,"primitive":"string"},"documentation":null,"annotations":null},{"name":"coordinates","index":4,"type":{"kind":"customType","nullable":false,"objectId":"13479800383264607709"},"documentation":null,"annotations":null}],"defaults":null}]},{"id":"18253202679260610236","packageName":"location","path":"v1/common/location/coordinates.nex","types":[{"id":"13479800383264607709","name":"Coordinates","documentation":null,"annotations":null,"modifier":"struct","baseType":null,"fields":[{"name":"latitude","index":0,"type":{"arguments":null,"kind":"primitiveValueType","nullable":false,"primitive":"float64"},"documentation":null,"annotations":null},{"name":"longitude","index":1,"type":{"arguments":null,"kind":"primitiveValueType","nullable":false,"primitive":"float64"},"documentation":null,"annotations":null}],"defaults":null}]},{"id":"2007497671615757376","packageName":"identity","path":"v1/identity/user.nex","types":[{"id":"15573699729907174246","name":"CustomerAccount","documentation":null,"annotations":null,"modifier":"struct","baseType":null,"fields":[{"name":"dni","index":0,"type":{"arguments":null,"kind":"primitiveValueType","nullable":false,"primitive":"string"},"documentation":null,"annotations":null}],"defaults":null},{"id":"2635019918070179479","name":"EmployeeAccount","documentation":null,"annotations":null,"modifier":"struct","baseType":null,"fields":[{"name":"permissions","index":0,"type":{"arguments":[{"arguments":null,"kind":"primitiveValueType","nullable":false,"primitive":"string"}],"kind":"primitiveValueType","nullable":false,"primitive":"list"},"documentation":null,"annotations":null}],"defaults":null},{"id":"13933365081113129845","name":"AdminAccount","documentation":null,"annotations":null,"modifier":"struct","baseType":null,"fields":[{"name":"full_access","index":0,"type":{"arguments":null,"kind":"primitiveValueType","nullable":false,"primitive":"bool"},"documentation":null,"annotations":null}],"defaults":null},{"id":"1018294955515524191","name":"User","documentation":null,"annotations":null,"modifier":"struct","baseType":"9851093560426766228","fields":[{"name":"first_name","index":4,"type":{"arguments":null,"kind":"primitiveValueType","nullable":false,"primitive":"string"},"documentation":null,"annotations":null},{"name":"last_name","index":5,"type":{"arguments":null,"kind":"primitiveValueType","nullable":false,"primitive":"string"},"documentation":null,"annotations":null},{"name":"email","index":6,"type":{"arguments":null,"kind":"primitiveValueType","nullable":false,"primitive":"string"},"documentation":null,"annotations":null},{"name":"tags","index":7,"type":{"arguments":[{"arguments":null,"kind":"primitiveValueType","nullable":true,"primitive":"string"}],"kind":"primitiveValueType","nullable":true,"primitive":"list"},"documentation":["List of tags"],"annotations":{"obsolete":true}},{"name":"preferences","index":8,"type":{"arguments":[{"arguments":null,"kind":"primitiveValueType","nullable":false,"primitive":"string"},{"arguments":null,"kind":"primitiveValueType","nullable":true,"primitive":"bool"}],"kind":"primitiveValueType","nullable":false,"primitive":"map"},"documentation":null,"annotations":{"header":["hola"]}},{"name":"account_type","index":9,"type":{"kind":"customType","nullable":false,"objectId":"17814066070050856057"},"documentation":null,"annotations":null},{"name":"account_details","index":10,"type":{"kind":"customType","nullable":false,"objectId":"10295209963266977739"},"documentation":null,"annotations":null},{"name":"address","index":11,"type":{"kind":"customType","nullable":false,"objectId":"13009575510080279639"},"documentation":null,"annotations":null}],"defaults":{"first_name":"Tomas","preferences":{"cats":false,"dogs":true}}},{"id":"17814066070050856057","name":"AccountType","documentation":null,"annotations":null,"modifier":"enum","baseType":null,"fields":[{"name":"unknown","index":0,"type":null,"documentation":null,"annotations":null},{"name":"admin","index":1,"type":null,"documentation":null,"annotations":null},{"name":"employee","index":2,"type":null,"documentation":null,"annotations":null},{"name":"customer","index":3,"type":null,"documentation":null,"annotations":null}],"defaults":null},{"id":"10295209963266977739","name":"AccountDetails","documentation":null,"annotations":null,"modifier":"union","baseType":null,"fields":[{"name":"customer","index":0,"type":{"kind":"customType","nullable":false,"objectId":"15573699729907174246"},"documentation":null,"annotations":null},{"name":"employee","index":1,"type":{"kind":"customType","nullable":false,"objectId":"2635019918070179479"},"documentation":null,"annotations":null},{"name":"admin","index":2,"type":{"kind":"customType","nullable":false,"objectId":"13933365081113129845"},"documentation":null,"annotations":null}],"defaults":null}]}]}import 'dart:convert';
import 'dart:io';

import 'package:nexema_generator/generator/generator.dart';
import 'package:nexema_generator/models.dart';

Future<void> main(List<String> args) async {
  String? input;

  input = await Future.microtask(() => stdin.readLineSync(encoding: utf8))
      .timeout(const Duration(seconds: 1));
  if (input == null) {
    throw "empty content";
  }

  // Parse definition
  var snapshot = NexemaSnapshot.fromJson(input);

  final parsedArgs =
      Map.fromIterable(args.map((e) => e.split("=").map((e) => MapEntry(e[0], e[1]))));

  print(parsedArgs);

  // verify arguments
  if (args.isEmpty) {
    _reportError("output-path argument is mandatory.");
    return;
  }

  // Create generator and execute
  var generator = Generator(
      snapshot: snapshot,
      settings: GeneratorSettings(outputPath: args.first, projectName: args.last));

  final result = generator.run();
  stdout.writeln(result.toJson());
  stdout.flush();
}

void _reportError(String msg) {
  stdout.writeln(msg);
  stdout.flush();
}
